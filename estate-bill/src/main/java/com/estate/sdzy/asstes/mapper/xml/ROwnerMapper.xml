<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.estate.sdzy.asstes.mapper.ROwnerMapper">
    <select id="getOwenerList" parameterType="java.util.Map" resultType="com.estate.sdzy.asstes.entity.ROwner">
        SELECT
        s_company.name as comp_name,
        r_owner.*
        FROM
        r_owner
        LEFT JOIN s_company on r_owner.comp_id = s_company.id
        <if test="commId != null and commId !=''">
            LEFT JOIN r_owner_property on r_owner_property.owner_id= r_owner.id
        </if>
        where
        r_owner.is_delete=0
        <if test="compId != null and compId !=''">
           and  r_owner.comp_id = #{compId}
        </if>
        <if test="commId != null and commId !=''">
            and r_owner_property.comm_id = #{commId}
        </if>
        <if test="pageNo!=null and size!=null">
            LIMIT #{pageNo},#{size}
        </if>
    </select>

    <select id="getOwenerByRoom" parameterType="java.util.Map" resultType="com.estate.sdzy.asstes.entity.ROwner">
        SELECT
            r_owner_property.id as prop_id,
            r_owner_property.type as prop_types,
            r_owner.*
        FROM
        r_owner
        LEFT JOIN r_owner_property on r_owner_property.owner_id= r_owner.id
        where
        r_owner.is_delete=0
        and r_owner_property.property_type = '房产'
        and r_owner_property.property_id = #{roomId}
    </select>
    <select id="getExcel" parameterType="java.util.Map" resultType="com.estate.sdzy.asstes.entity.ROwner">
        SELECT
            s_company.NAME AS comp_name,
            r_owner.owner_type,
            r_owner.NAME,
            r_owner.owner_addr,
            r_owner.tel,
            r_owner.e_mail,
            r_owner.cert_type,
            r_owner.cert_number,
            r_owner.industry,
            r_owner.sex,
            r_owner.native_place,
            r_owner.education,
            r_owner.state,
            r_owner.link_name,
            r_owner.link_tel,
            r_owner.link_addr,
            r_owner.remark,
            r_owner.created_name,
            r_owner.created_at,
            r_owner.modified_name,
            r_owner.modified_at
        FROM
            r_owner
            LEFT JOIN s_company ON s_company.id = r_owner.comp_id
            <if test="commId!=null and commId!=''">
                LEFT JOIN r_owner_property ON r_owner_property.owner_id = r_owner.id
            </if>
        WHERE
            r_owner.is_delete = 0
            <if test="compId!=null and compId!=''">
                AND r_owner.comp_id = #{compId}
            </if>
            <if test="commId!=null and commId!=''">
                AND r_owner_property.comm_id = #{commId}
            </if>
    </select>

    <select id="selectPageTotal" parameterType="java.util.Map" resultType="java.lang.Integer">
        SELECT
        count (r_owner.id)
        FROM
        r_owner
        <if test="commId!=null and commId!=''">
            LEFT JOIN r_owner_property ON r_owner_property.owner_id = r_owner.id
        </if>
        WHERE
        r_owner.is_delete = 0
        <if test="compId!=null and compId!=''">
            AND r_owner.comp_id = #{compId}
        </if>
        <if test="commId!=null and commId!=''">
            AND r_owner_property.comm_id = #{commId}
        </if>
    </select>
</mapper>
